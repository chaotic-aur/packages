# Maintainer: goll <adrian.goll+aur[at]gmail>
# Contributor: George Woodall <georgewoodall82@gmail.com>
pkgname=bambustudio-bin
pkgver=02.03.00.70
pkgrel=2
pkgdesc="PC Software for BambuLab's 3D printers"
arch=("x86_64")
url="https://github.com/bambulab/BambuStudio"
license=('AGPL3')
conflicts=('bambustudio' 'bambustudio-git' 'squashfuse')
depends=('mesa' 'glu' 'cairo' 'gtk3' 'libsoup' 'webkit2gtk' 'gstreamer' 'openvdb' 'wayland' 'wayland-protocols' 'libxkbcommon' 'gst-libav' 'webkit2gtk-4.1')
makedepends=('fuse2' 'patchelf')
# Thanks so much for generating random image names Bambu, much appreciated, keeps you on your toes or something I guess...
source=("bambustudio-${pkgver}.AppImage::https://github.com/bambulab/BambuStudio/releases/download/v${pkgver}/Bambu_Studio_ubuntu-24.04_PR-8184.AppImage"
  "BambuStudio.desktop"
  "bambu-studio")
sha256sums=('60ef861e204e7d6da518619bd7b7c5ab2ae2a1bd9a5fb79d10b7c4495f73b172'
  'SKIP'
  'SKIP')

package() {
  cd "$srcdir"
  chmod +x ./bambustudio-${pkgver}.AppImage
  ./bambustudio-${pkgver}.AppImage --appimage-extract
  cd squashfs-root
  mkdir $pkgdir/opt/
  mkdir $pkgdir/opt/bambustudio-bin
  cp -r ./usr "$pkgdir/"
  cp -r ./* "$pkgdir/opt/bambustudio-bin/"
  patchelf --remove-needed libOSMesa.so.8 "$pkgdir/opt/bambustudio-bin/bin/bambu-studio"

  cd "$srcdir"

  mkdir "$pkgdir/usr/bin/"
  chmod +x ./bambu-studio
  cp ./bambu-studio "$pkgdir/usr/bin/"

  mkdir "$pkgdir/usr/share/applications/"
  cp ./BambuStudio.desktop "$pkgdir/usr/share/applications/BambuStudio.desktop"
}
